\ProvidesClass{beamerthemeusn}[2018/06/25]

\mode<presentation>

\RequirePackage{pgf}
\RequirePackage[authoryear,round]{natbib}
\RequirePackage{xcolor}
\RequirePackage{textcomp}
\RequirePackage[defaultsans]{opensans}

%%% new colours as of 2023
% level 1
\definecolor{lilla}{RGB}{120,0,240}
\definecolor{medium-lilla}{RGB}{147,89,239}
\definecolor{lys-lilla}{RGB}{205,185,252}
\definecolor{indigo}{RGB}{47,11,99}
\definecolor{medium-indigo}{RGB}{149,149,249}
\definecolor{lys-indigo}{RGB}{218,217,255}
% level 2
\definecolor{oransje}{RGB}{255,98,2}
\definecolor{beige}{RGB}{255,217,177}
\definecolor{medium-beige}{RGB}{255,235,211}
\definecolor{lys-beige}{RGB}{255,245,238}
% level 3
\definecolor{rosa}{RGB}{239,125,187}
\definecolor{medium-rosa}{RGB}{255,204,237}
\definecolor{syregronn}{RGB}{207,255,31}
\definecolor{medium-syregronn}{RGB}{228,255,125}

%%% old signal colours 2018-2023
% colours
\definecolor{PMS2369U}{RGB}{70,70,165}
\definecolor{PMS200U}{RGB}{214,67,73}
\definecolor{PMS120U}{RGB}{255,210,64}
\definecolor{PMS312U}{RGB}{39,178,208}
\definecolor{PMS2400U}{RGB}{59,175,162}
% support colours
\definecolor{PMS3005U}{RGB}{15,118,175}
\definecolor{PMS310U}{RGB}{154,212,226}
\definecolor{PMS327U}{RGB}{0,151,138}
\definecolor{PMS358U}{RGB}{157,210,159}
% additional colours
\definecolor{PMS2332U}{RGB}{140,150,150}
\definecolor{PMS2331U}{RGB}{175,182,179}
\definecolor{PMS434U}{RGB}{210,215,215}
\definecolor{PMS444U}{RGB}{126,148,146}
\definecolor{PMS442U}{RGB}{166,182,179}
\definecolor{PMS538U}{RGB}{200,215,215}
% special colour
\definecolor{PMS876}{RGB}{148,102,75} % copper

\setbeamercolor{frametitle}{fg=black}
\setbeamercolor{title}{fg=black}
\setbeamercolor{subtitle}{fg=black}
\setbeamercolor{item}{fg=black}

\setbeamercolor{footline}{bg=white,fg=black}
\setbeamerfont{footline}{size=\tiny}

%% some useful lengths
\newlength{\usnspacing}
\setlength{\usnspacing}{0.032\paperheight}
\newlength{\usnrulewidth}
\setlength{\usnrulewidth}{\paperwidth}
\addtolength{\usnrulewidth}{-2\usnspacing}
\newlength{\usnrulestart}
\setlength{\usnrulestart}{\paperheight}
\addtolength{\usnrulestart}{-0.042\paperheight}
\newlength{\usnfgheight}
\setlength{\usnfgheight}{\usnrulestart}
\addtolength{\usnfgheight}{-1.5\usnspacing}

%% turn off all navigation symbols
\setbeamertemplate{navigation symbols}{}

%% rounded drop shadows for boxes
\setbeamertemplate{blocks}[rounded][shadow=true]

%% load pictures that are used one several slides
\pgfdeclareimage[height=0.15\paperheight,interpolate=true]{usnlogo}{./figs/usnlogo}
\pgfdeclareimage[height=12pt,interpolate=true]{usn}{./figs/usnlogo}

%% Name in footer
\newcommand{\usnfootername}{%
{\fontsize{5pt}{5pt}\sffamily\bfseries\selectfont \raisebox{-1pt}{\pgfuseimage{usn}}~---~University of South-Eastern Norway}}

%% Logo in footer
\newcommand{\usnfooterlogo}{%
{\raisebox{-5pt}{\pgfuseimage{usn}}}}
\addtobeamertemplate{footline}{\vspace*{1pt}}{\vspace*{15pt}}

% set only front page
\defbeamertemplate{background canvas}{usn theme titlepage}%
{%
\begin{pgfpicture}{0}{0}{\paperwidth}{\paperheight}
\pgfputat{\pgfpoint{\usnspacing}{1.5\usnspacing}}{{\color{lys-indigo}\rule{\usnrulewidth}{\usnfgheight}}}
\pgfputat{\pgfpoint{3*\usnspacing}{0.76\paperheight}}{\pgfbox[left,base]{\pgfuseimage{usnlogo}}}
\end{pgfpicture}%
}

\defbeamertemplate{headline}{usn theme titlepage}%
{%
     \begin{pgfpicture}{0}{0}{\paperwidth}{\paperheight}
       \pgfputat{\pgfpoint{\usnspacing}{\usnrulestart}}{%
       \pgfbox[left,base]{\color{lilla}\rule{\usnrulewidth}{0.01\paperheight}}
       }
     \end{pgfpicture}%
}

\defbeamertemplate{footline}{usn theme titlepage}%
{% empty footline on title
}

\newcommand{\usntitlepage}{%
{%
\setbeamertemplate{background canvas}[usn theme titlepage]
\setbeamertemplate{headline}[usn theme titlepage]
\setbeamertemplate{footline}[usn theme titlepage]
\begin{frame}%[plain]%
\titlepage%
\end{frame}%
}%
}

%% fonts and title formatting
\usefonttheme[onlymath]{serif}
\setbeamerfont{frametitle}{family=\rmfamily}
%\setbeamercolor{framesubtitle}{fg=medium-lilla}
\setbeamerfont{title}{family=\rmfamily,series=\bfseries,size=\Large}
\setbeamerfont{author}{series=\bfseries}
\setbeamercolor{author}{fg=lilla}
\setbeamercolor{institute}{fg=lilla}
\setbeamercolor{date}{fg=lilla}

%% inner theme details
\defbeamertemplate{itemize subitem}{dash}{\raisebox{0.6ex}{\rule{.4em}{1pt}}}
\defbeamertemplate{itemize subsubitem}{dash}{\raisebox{0.6ex}{\rule{.4em}{1pt}}}
\setbeamertemplate{itemize item}[circle]  % ball, circle, rectangle, default
\setbeamertemplate{itemize subitem}[dash]
\setbeamertemplate{itemize subsubitem}[rectangle]
%\setbeamertmeplate{itemize item subsubitem}[circle]
%\setbeamertemplate{bibliography item}[text]
\bibliographystyle{apalike}

\setbeamertemplate{headline}{
     \begin{pgfpicture}{0}{0}{\paperwidth}{0.042\paperheight}
       \pgfputat{\pgfpoint{\usnspacing}{0pt}}{\pgfbox[left,base]{%
           \color{lilla}\rule{\usnrulewidth}{0.01\paperheight}}
       }
     \end{pgfpicture}
}

\setbeamertemplate{footline}{
  \begin{pgfpicture}{0}{0}{\paperwidth}{1.5\usnspacing}
    \pgfputat{\pgfpoint{\usnspacing}{0.5\usnspacing}}{\pgfbox[left,base]{%
        \parbox{\usnrulewidth}{\usnfooterlogo \hfill
          \insertshorttitle ~ \insertshortsubtitle \hfill
          \insertframenumber / \inserttotalframenumber}
     }}
  \end{pgfpicture}
\vspace*{0.5\usnspacing} % add some padding at the very bottom
}

\defbeamertemplate*{title page}{usn}[1][]
{
  \centering
  \par\vfill
  {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}
  {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}
  {\color{medium-indigo} \rule{9mm}{1pt}}\par\vspace{2mm}
  {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}\vspace{2mm}
  {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}
  {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}
  {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
}

\let\Tiny=\tiny

\mode
<all>
